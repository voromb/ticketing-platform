# üé´ Ticketing Platform - Arquitectura de Microservicios

## √çndice

- [Visi√≥n General](#-visi√≥n-general)
- [Arquitectura del Sistema](#-arquitectura-del-sistema)
- [Microservicios](#-microservicios)
- [Stack Tecnol√≥gico](#-stack-tecnol√≥gico)
- [Flujos de Trabajo](#-flujos-de-trabajo)
- [Instalaci√≥n y Configuraci√≥n](#-instalaci√≥n-y-configuraci√≥n)
- [Estructura del Proyecto](#-estructura-del-proyecto)
- [API Documentation](#-api-documentation)

## Visi√≥n General

Plataforma completa de gesti√≥n de festivales de rock/metal que incluye venta de tickets, servicios complementarios (viajes, restaurantes, merchandising) y paneles de administraci√≥n diferenciados por roles y servicios.

### Objetivos Principales

- **Modularidad**: Cada servicio es independiente y escalable
- **Separaci√≥n de Responsabilidades**: Cada microservicio maneja un dominio espec√≠fico
- **Comunicaci√≥n As√≠ncrona**: Uso de RabbitMQ para eventos y aprobaciones
- **Multi-Database**: PostgreSQL, MongoDB y Redis seg√∫n las necesidades
- **Multi-Panel**: Interfaces diferenciadas por color seg√∫n el servicio

## Arquitectura del Sistema

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         FRONTEND LAYER                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   Admin    ‚îÇ   User    ‚îÇ  Travel  ‚îÇRestaurant ‚îÇ  Merchandising  ‚îÇ
‚îÇ   Panel    ‚îÇ   Panel   ‚îÇ  Panel   ‚îÇ  Panel    ‚îÇ     Panel       ‚îÇ
‚îÇ  (Dark)    ‚îÇ  (White)  ‚îÇ  (Red)   ‚îÇ  (Green)  ‚îÇ     (Blue)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ            ‚îÇ          ‚îÇ           ‚îÇ              ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                 ‚îÇ   API GATEWAY (NestJS)  ‚îÇ
                 ‚îÇ      Puerto: 3000       ‚îÇ
                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ                        ‚îÇ                       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  EXISTING ‚îÇ  ‚îÇ   NEW MICROSERVICES LAYER   ‚îÇ  ‚îÇ  APPROVAL  ‚îÇ
‚îÇ  SERVICES ‚îÇ  ‚îÇ         (NestJS)            ‚îÇ  ‚îÇ   SERVICE  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ           ‚îÇ  ‚îÇ                             ‚îÇ  ‚îÇ            ‚îÇ
‚îÇ  Admin    ‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ  ‚îÇ  Approval  ‚îÇ
‚îÇ  Service  ‚îÇ  ‚îÇ  ‚îÇ Travel ‚îÇ  ‚îÇRestaurant‚îÇ   ‚îÇ  ‚îÇ  Gateway   ‚îÇ
‚îÇ  :3003    ‚îÇ  ‚îÇ  ‚îÇService ‚îÇ  ‚îÇ Service  ‚îÇ   ‚îÇ  ‚îÇ   :3007    ‚îÇ
‚îÇ           ‚îÇ  ‚îÇ  ‚îÇ :3004  ‚îÇ  ‚îÇ  :3005   ‚îÇ   ‚îÇ  ‚îÇ            ‚îÇ
‚îÇ  User     ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ  ‚îÇ  Workflow  ‚îÇ
‚îÇ  Service  ‚îÇ  ‚îÇ                             ‚îÇ  ‚îÇ  Engine    ‚îÇ
‚îÇ  :3001    ‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ  ‚îÇ            ‚îÇ
‚îÇ           ‚îÇ  ‚îÇ  ‚îÇ  Merchandising     ‚îÇ     ‚îÇ  ‚îÇNotification‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ  ‚îÇ     Service        ‚îÇ     ‚îÇ  ‚îÇ  Manager   ‚îÇ
               ‚îÇ  ‚îÇ      :3006         ‚îÇ     ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                 ‚îÇ    MESSAGE BROKER       ‚îÇ
                 ‚îÇ      (RabbitMQ)         ‚îÇ
                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                     ‚îÇ                    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PostgreSQL  ‚îÇ    ‚îÇ     MongoDB      ‚îÇ   ‚îÇ    Redis     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ              ‚îÇ    ‚îÇ                  ‚îÇ   ‚îÇ              ‚îÇ
‚îÇ - Events     ‚îÇ    ‚îÇ - Users          ‚îÇ   ‚îÇ - Cache      ‚îÇ
‚îÇ - Venues     ‚îÇ    ‚îÇ - Sessions       ‚îÇ   ‚îÇ - Sessions   ‚îÇ
‚îÇ - Admins     ‚îÇ    ‚îÇ - Preferences    ‚îÇ   ‚îÇ - Temp Data  ‚îÇ
‚îÇ              ‚îÇ    ‚îÇ                  ‚îÇ   ‚îÇ - Queues     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Microservicios

### 1. API Gateway (Puerto: 3000)

**Responsabilidades:**

- Punto de entrada √∫nico para todos los clientes
- Routing inteligente hacia microservicios
- Autenticaci√≥n y autorizaci√≥n centralizada
- Rate limiting y throttling
- Agregaci√≥n de respuestas
- Circuit breaker pattern

**Tecnolog√≠as:**

- NestJS + Express
- JWT validation
- Redis para cach√©
- Swagger documentation

### 2. Travel Service (Puerto: 3004)

**Panel:** Rojo Pastel üî¥

**Funcionalidades:**

- Gesti√≥n de viajes al festival
- Reserva de transporte (autobuses, shuttles)
- Coordinaci√≥n de grupos
- Tracking de rutas
- Gesti√≥n de paradas

**Base de Datos:** Redis + MongoDB

```javascript
{
  tripId: String,
  festivalId: String,
  departure: {
    location: String,
    datetime: Date,
    coordinates: [lat, lng]
  },
  arrival: {
    location: String,
    estimatedTime: Date
  },
  capacity: Number,
  bookedSeats: Number,
  status: 'SCHEDULED' | 'BOARDING' | 'IN_TRANSIT' | 'COMPLETED',
  requiresApproval: Boolean
}
```

### 3. Restaurant Service (Puerto: 3005)

**Panel:** Verde Pastel üü¢

**Funcionalidades:**

- Cat√°logo de restaurantes del festival
- Sistema de reservas
- Gesti√≥n de men√∫s y dietas especiales
- Control de aforo
- Pre-pedidos para eventos

**Base de Datos:** Redis + MongoDB

```javascript
{
  restaurantId: String,
  festivalId: String,
  name: String,
  cuisine: String,
  capacity: Number,
  menu: [{
    itemId: String,
    name: String,
    price: Number,
    dietary: ['vegetarian', 'vegan', 'gluten-free'],
    availability: Number
  }],
  bookings: [{
    userId: String,
    datetime: Date,
    guests: Number,
    specialRequests: String,
    status: 'PENDING' | 'CONFIRMED' | 'CANCELLED'
  }]
}
```

### 4. Merchandising Service (Puerto: 3006)

**Panel:** Azul Pastel üîµ

**Funcionalidades:**

- Cat√°logo de productos por banda
- Gesti√≥n de inventario
- Pre-orders y reservas
- Productos exclusivos VIP
- Sistema de puntos de recogida

**Base de Datos:** Redis + MongoDB

```javascript
{
  productId: String,
  bandId: String,
  festivalId: String,
  type: 'TSHIRT' | 'VINYL' | 'POSTER' | 'ACCESSORIES',
  name: String,
  description: String,
  price: Number,
  sizes: ['S', 'M', 'L', 'XL', 'XXL'],
  stock: {
    total: Number,
    reserved: Number,
    available: Number
  },
  images: [String],
  exclusive: Boolean,
  preOrderEnabled: Boolean
}
```

### 5. Approval Service (Puerto: 3007)

**Responsabilidades:**

- Centralizaci√≥n de todas las aprobaciones
- Workflow engine para procesos de aprobaci√≥n
- Notificaciones push/email a administradores
- Escalaci√≥n autom√°tica
- Auditor√≠a de decisiones

**Flujo de Aprobaci√≥n:**

```mermaid
graph LR
    A[Solicitud] --> B{Validaci√≥n}
    B -->|V√°lida| C[Cola de Aprobaci√≥n]
    B -->|Inv√°lida| D[Rechazada]
    C --> E{Admin Decision}
    E -->|Aprueba| F[Notificar Servicio]
    E -->|Rechaza| G[Notificar Rechazo]
    E -->|Timeout| H[Escalaci√≥n]
    H --> I[Super Admin]
```

**Base de Datos:** Redis (para estado temporal) + PostgreSQL (para auditor√≠a)

## Stack Tecnol√≥gico

### Backend

- **Framework:** NestJS 10.x
- **Runtime:** Node.js 20.x LTS
- **Language:** TypeScript 5.x
- **API Style:** REST + WebSockets (para real-time)

### Databases

- **PostgreSQL 15:** Datos transaccionales (eventos, venues, auditor√≠a)
- **MongoDB 7:** Datos flexibles (usuarios, preferencias, cat√°logos)
- **Redis 7:** Cache, sesiones, colas temporales

### Message Broker

- **RabbitMQ 3.12:** Comunicaci√≥n as√≠ncrona entre servicios
  - Exchanges: `festival.events`, `festival.approvals`
  - Queues: Por servicio y tipo de evento
  - Dead Letter Queues para manejo de errores

### Infrastructure

- **Docker & Docker Compose:** Orquestaci√≥n local
- **Kubernetes:** Orquestaci√≥n en producci√≥n (futuro)
- **API Gateway:** Kong o AWS API Gateway (producci√≥n)

### Monitoring & Logging

- **Logs:** Winston + ELK Stack
- **Metrics:** Prometheus + Grafana
- **Tracing:** Jaeger
- **Health Checks:** Terminus (NestJS)

## Flujos de Trabajo

### Flujo de Reserva de Restaurante

```
1. Usuario selecciona restaurante y horario
2. Restaurant Service valida disponibilidad
3. Si requiere aprobaci√≥n (ej: mesa VIP):
   ‚îî‚îÄ‚îÄ Env√≠a evento a RabbitMQ
   ‚îî‚îÄ‚îÄ Approval Service recibe y procesa
   ‚îî‚îÄ‚îÄ Notifica a Admin Panel
   ‚îî‚îÄ‚îÄ Admin aprueba/rechaza
   ‚îî‚îÄ‚îÄ Approval Service notifica resultado
4. Restaurant Service confirma reserva
5. Env√≠a confirmaci√≥n al usuario
```

### Flujo de Compra de Merchandising

```
1. Usuario browse cat√°logo de productos
2. A√±ade items al carrito
3. Merchandising Service reserva stock temporalmente
4. Procesa pago via Payment Service (existente)
5. Confirma orden y actualiza inventario
6. Genera c√≥digo QR para recogida
7. Notifica punto de recogida
```

### Flujo de Reserva de Viaje

```
1. Usuario busca viajes disponibles
2. Selecciona origen y horario
3. Travel Service verifica disponibilidad
4. Reserva asientos
5. Si es grupo grande (>10 personas):
   ‚îî‚îÄ‚îÄ Requiere aprobaci√≥n especial
6. Genera tickets con QR
7. Env√≠a informaci√≥n de embarque
```

## Instalaci√≥n y Configuraci√≥n

### Prerrequisitos

```bash
- Node.js 20.x LTS
- Docker Desktop
- NestJS CLI (`npm i -g @nestjs/cli`)
- Redis CLI (opcional)
- MongoDB Compass (opcional)
```

### Instalaci√≥n Paso a Paso

#### 1. Clonar y preparar el repositorio

```bash
git clone https://github.com/voromb/ticketing-platform.git
cd ticketing-platform
git checkout feature_Voro_2
```

#### 2. Levantar servicios base con Docker

```bash
cd docker
docker-compose up -d
```

#### 3. Instalar API Gateway

```bash
cd ../backend/microservices
nest new api-gateway --package-manager npm
cd api-gateway
npm install @nestjs/microservices @nestjs/config
npm install amqplib amqp-connection-manager
npm install @nestjs/jwt @nestjs/passport
npm install @nestjs/swagger swagger-ui-express
```

#### 4. Instalar Travel Service

```bash
cd ../
nest new travel-service --package-manager npm
cd travel-service
npm install @nestjs/microservices
npm install @nestjs/mongoose mongoose
npm install @nestjs/redis redis
npm install @nestjs/config
```

#### 5. Configurar Restaurant Service

```bash
cd ../
nest new restaurant-service --package-manager npm
cd restaurant-service
# Mismas dependencias que Travel Service
```

#### 6. Configurar Merchandising Service

```bash
cd ../
nest new merchandising-service --package-manager npm
cd merchandising-service
# Mismas dependencias que Travel Service
```

#### 7. Configurar Approval Service

```bash
cd ../
nest new approval-service --package-manager npm
cd approval-service
npm install @nestjs/microservices
npm install @nestjs/redis redis
npm install @prisma/client prisma
npm install @nestjs/config
```

### Variables de Entorno (.env)

#### API Gateway

```env
PORT=3000
JWT_SECRET=your-jwt-secret
REDIS_HOST=localhost
REDIS_PORT=6379
RABBITMQ_URL=amqp://localhost:5672
```

#### Microservicios

```env
# Travel Service
PORT=3004
MONGODB_URI=mongodb://localhost:27017/travel_service
REDIS_HOST=localhost
REDIS_PORT=6379
RABBITMQ_URL=amqp://localhost:5672

# Restaurant Service
PORT=3005
MONGODB_URI=mongodb://localhost:27017/restaurant_service
REDIS_HOST=localhost
REDIS_PORT=6379
RABBITMQ_URL=amqp://localhost:5672

# Merchandising Service
PORT=3006
MONGODB_URI=mongodb://localhost:27017/merch_service
REDIS_HOST=localhost
REDIS_PORT=6379
RABBITMQ_URL=amqp://localhost:5672

# Approval Service
PORT=3007
DATABASE_URL="postgresql://admin:admin123@localhost:5432/approvals_db"
REDIS_HOST=localhost
REDIS_PORT=6379
RABBITMQ_URL=amqp://localhost:5672
```

## Estructura del Proyecto

```
ticketing-platform/
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ ticketing-app/          # Angular - User Panel (White)
‚îÇ   ‚îú‚îÄ‚îÄ admin-panel/            # Angular - Admin Panel (Dark)
‚îÇ   ‚îú‚îÄ‚îÄ travel-panel/           # Angular - Travel Panel (Red)
‚îÇ   ‚îú‚îÄ‚îÄ restaurant-panel/       # Angular - Restaurant Panel (Green)
‚îÇ   ‚îî‚îÄ‚îÄ merchandising-panel/    # Angular - Merch Panel (Blue)
‚îÇ
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ admin-service/          # Existing - Express + PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ user-service/           # Existing - Fastify + MongoDB
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ microservices/          # New NestJS Services
‚îÇ       ‚îú‚îÄ‚îÄ api-gateway/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.ts
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.module.ts
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ proxy/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ common/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ travel-service/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trips/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bookings/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ events/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ restaurant-service/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ restaurants/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reservations/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ menus/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ events/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ merchandising-service/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ products/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ orders/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inventory/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ events/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ       ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ approval-service/
‚îÇ           ‚îú‚îÄ‚îÄ src/
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ approvals/
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ workflows/
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ notifications/
‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ audit/
‚îÇ           ‚îî‚îÄ‚îÄ package.json
‚îÇ
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.microservices.yml  # New
‚îÇ   ‚îú‚îÄ‚îÄ init-scripts/
‚îÇ   ‚îî‚îÄ‚îÄ bd_backup/
‚îÇ
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ architecture/
‚îÇ   ‚îî‚îÄ‚îÄ deployment/
‚îÇ
‚îî‚îÄ‚îÄ scripts/
    ‚îú‚îÄ‚îÄ start-all.sh
    ‚îú‚îÄ‚îÄ stop-all.sh
    ‚îî‚îÄ‚îÄ reset-databases.sh
```

## API Documentation

### Endpoints Principales

#### API Gateway Routes

```typescript
// Auth
POST   /api/auth/login
POST   /api/auth/refresh
POST   /api/auth/logout

// Travel Service
GET    /api/travel/trips
GET    /api/travel/trips/:id
POST   /api/travel/trips/:id/book
DELETE /api/travel/bookings/:id
GET    /api/travel/my-bookings

// Restaurant Service
GET    /api/restaurants
GET    /api/restaurants/:id
GET    /api/restaurants/:id/menu
POST   /api/restaurants/:id/reserve
GET    /api/restaurants/my-reservations
DELETE /api/restaurants/reservations/:id

// Merchandising Service
GET    /api/merchandise/products
GET    /api/merchandise/products/:id
POST   /api/merchandise/cart/add
GET    /api/merchandise/cart
POST   /api/merchandise/checkout
GET    /api/merchandise/orders

// Approval Service (Admin only)
GET    /api/approvals/pending
GET    /api/approvals/history
POST   /api/approvals/:id/approve
POST   /api/approvals/:id/reject
GET    /api/approvals/stats
```

### WebSocket Events

```typescript
// Real-time notifications
//localhost:3000/events

// Events emitted:
ws: -"approval.requested" -
  "approval.completed" -
  "booking.confirmed" -
  "order.status.changed" -
  "inventory.low";
```

### RabbitMQ Events

```typescript
// Exchange: festival.events
interface TravelBookingEvent {
  type: "TRAVEL_BOOKING_CREATED";
  payload: {
    bookingId: string;
    userId: string;
    tripId: string;
    seats: number;
    requiresApproval: boolean;
  };
}

interface RestaurantReservationEvent {
  type: "RESTAURANT_RESERVATION_CREATED";
  payload: {
    reservationId: string;
    userId: string;
    restaurantId: string;
    datetime: Date;
    guests: number;
    specialRequests?: string;
  };
}

interface MerchandiseOrderEvent {
  type: "MERCHANDISE_ORDER_CREATED";
  payload: {
    orderId: string;
    userId: string;
    items: Array<{
      productId: string;
      quantity: number;
      size?: string;
    }>;
    total: number;
  };
}

// Exchange: festival.approvals
interface ApprovalRequestEvent {
  type: "APPROVAL_REQUESTED";
  payload: {
    approvalId: string;
    service: "TRAVEL" | "RESTAURANT" | "MERCHANDISE";
    entityId: string;
    requestedBy: string;
    priority: "LOW" | "MEDIUM" | "HIGH";
    metadata: any;
  };
}

interface ApprovalDecisionEvent {
  type: "APPROVAL_DECISION";
  payload: {
    approvalId: string;
    decision: "APPROVED" | "REJECTED";
    decidedBy: string;
    reason?: string;
    timestamp: Date;
  };
}
```
